<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>سلة المشتريات — AL_rahike</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#fff; --accent:#3C3633; --muted:#747264; --container:1200px; --shadow:0 4px 12px rgba(0,0,0,0.08);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--accent);padding:20px;}
.container{max-width:var(--container);margin:0 auto;}
.section-title{font-size:28px;text-align:center;margin-bottom:30px;position:relative;}
.section-title:after{content:'';position:absolute;bottom:0;right:50%;transform:translateX(50%);width:80px;height:2px;background:var(--accent);}
.checkout-container{display:grid;grid-template-columns:1fr 1fr;gap:40px;}
.checkout-form,.cart-summary{background:#f9f9f9;padding:20px;border-radius:8px;box-shadow:var(--shadow);}
.form-group{margin-bottom:15px;}
.form-group label{display:block;margin-bottom:6px;font-weight:500;}
.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-family:inherit;}
.checkout-btn{width:100%;padding:15px;background:var(--accent);color:#fff;border:none;border-radius:4px;font-weight:500;cursor:pointer;margin-top:10px;}
.checkout-btn:hover{background:#7a2121;}
.cart-items{margin-bottom:20px;}
.cart-item{display:flex;justify-content:space-between;padding:15px 0;border-bottom:1px solid #eee;}
.cart-item:last-child{border-bottom:none;}
.cart-item-info{display:flex;gap:15px;}
.cart-item-image{width:80px;height:80px;background:white;border-radius:4px;display:flex;align-items:center;justify-content:center;}
.cart-item-image img{max-width:90%;max-height:90%;object-fit:contain;}
.cart-item-details{flex:1;}
.cart-item-title{font-weight:500;margin-bottom:5px;}
.cart-item-price{color:#7a2121;font-weight:500;}
.cart-totals{border-top:1px solid #eee;padding-top:20px;}
.cart-total-row{display:flex;justify-content:space-between;margin-bottom:10px;}
.cart-total-row:last-child{font-weight:700;font-size:18px;}
.empty-cart{text-align:center;padding:60px 0;}
.btn{padding:12px 24px;background:var(--accent);color:white;border-radius:4px;text-decoration:none;display:inline-block;}
.btn:hover{background:#7a2121;}
@media(max-width:992px){.checkout-container{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
<h1 class="section-title">سلة المشتريات</h1>
<div class="checkout-container">
  <div class="checkout-form">
    <h2>معلومات العميل</h2>
    <form id="checkoutForm">
      <div class="form-group"><label>الاسم الكامل</label><input type="text" id="fullname" required></div>
      <div class="form-group"><label>رقم الهاتف</label><input type="tel" id="phone" required></div>
      <div class="form-group"><label>البريد الإلكتروني (اختياري)</label><input type="email" id="email"></div>
      <div class="form-group"><label>العنوان</label><textarea id="address" rows="2" required></textarea></div>
      <div class="form-group"><label>المدينة</label><input type="text" id="city" required></div>
      <h2>طريقة الدفع</h2>
      <div class="form-group"><label><input type="radio" name="paymentMethod" value="cash" checked> الدفع عند الاستلام</label></div>
      <div class="form-group"><label><input type="radio" name="paymentMethod" value="bank"> التحويل البنكي</label></div>
      <button type="submit" class="checkout-btn">تأكيد الطلب</button>
    </form>
  </div>

  <div class="cart-summary">
    <h2>ملخص الطلب</h2>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-totals">
      <div class="cart-total-row"><span>المجموع الفرعي</span><span id="subtotal">0 DH</span></div>
      <div class="cart-total-row"><span>الشحن</span><span>5 DH</span></div>
      <div class="cart-total-row"><span>المجموع الكلي</span><span id="total">5 DH</span></div>
    </div>
  </div>
</div>
</div>

<script>
const CART_KEY='al_rahike_cart_v1';
function readCart(){try{return JSON.parse(localStorage.getItem(CART_KEY)||'[]')}catch{return[];}}
function renderCartItems(){
  const cart=readCart(),el=document.getElementById('cartItems');
  let subtotal=0;
  if(cart.length===0){el.innerHTML='<div class="empty-cart"><p>السلة فارغة</p><a href="index.html" class="btn">العودة إلى المتجر</a></div>';document.getElementById('subtotal').textContent='0 DH';document.getElementById('total').textContent='5 DH';return;}
  let html='';
  cart.forEach(i=>{
    const t=(i.price||0)*(i.qty||1);subtotal+=t;
    html+=`<div class="cart-item"><div class="cart-item-info"><div class="cart-item-image"><img src="${i.image||'photo/um1.jpg'}" alt="${i.name}"></div><div class="cart-item-details"><div class="cart-item-title">${i.name}</div><div class="cart-item-price">${i.price.toLocaleString()} DH</div></div></div><div class="cart-item-qty"><span>${i.qty||1} ×</span></div></div>`;
  });
  el.innerHTML=html;
  document.getElementById('subtotal').textContent=subtotal.toLocaleString()+' DH';
  document.getElementById('total').textContent=(subtotal+50).toLocaleString()+' DH';
}
document.getElementById('checkoutForm').addEventListener('submit',e=>{
  e.preventDefault();
  const cart=readCart();
  if(cart.length===0){alert('السلة فارغة');return;}
  const data={
    fullName:document.getElementById('fullname').value,
    phone:document.getElementById('phone').value,
    email:document.getElementById('email').value,
    address:document.getElementById('address').value,
    city:document.getElementById('city').value,
    paymentMethod:document.querySelector('input[name="paymentMethod"]:checked').value,
    cart:cart,
    subtotal:document.getElementById('subtotal').textContent,
    total:document.getElementById('total').textContent
  };
  const msg=`طلب جديد من ${data.fullName}\nالهاتف: ${data.phone}\nالبريد: ${data.email||'غير محدد'}\nالعنوان: ${data.address}, ${data.city}\nطريقة الدفع: ${data.paymentMethod==='cash'?'الدفع عند الاستلام':'التحويل البنكي'}\nالمنتجات:\n${cart.map(i=>`- ${i.name} (${i.qty} × ${i.price} DH)`).join('\n')}\nالمجموع: ${data.total}`;
  fetch(`https://api.telegram.org/bot7992402819:AAGr2bXG8ir15dWqT7eBtf5UgAvTA4GgC2c/sendMessage`,{
    method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id:'6230578464',text:msg})
  }).then(r=>r.json()).then(d=>{alert('تم استلام طلبك بنجاح!');localStorage.removeItem(CART_KEY);renderCartItems();window.location.href='index.html';}).catch(()=>alert('حدث خطأ أثناء الإرسال')); 
});
document.addEventListener('DOMContentLoaded',()=>{renderCartItems();});
</script>
</body>
</html>
